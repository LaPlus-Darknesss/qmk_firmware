name: Build ErgoDox EZ (QMK)
on:
  workflow_dispatch:
  push:
    paths:
      - 'keyboards/ergodox_ez/**'
      - '.github/workflows/build-ergodox-ez.yml'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Build using the qmk_firmware container and 'make'
      - name: Build with qmk_firmware Docker
        run: |
          docker run --rm \
            -v "$GITHUB_WORKSPACE":/qmk \
            -w /qmk \
            qmkfm/qmk_firmware \
            make ergodox_ez/glow:modified

      - name: Collect firmware
        run: |
          mkdir -p firmware_out
          # QMK names the file like ergodox_ez_glow_YOUR_KEYMAP.hex; also copy from .build if present
          cp -f *.hex firmware_out/ 2>/dev/null || true
          cp -f .build/*.hex firmware_out/ 2>/dev/null || true
          ls -al firmware_out || true

      - uses: actions/upload-artifact@v4
        with:
          name: ergodox-ez-firmware
          path: firmware_out
